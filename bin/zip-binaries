#!/bin/bash -eu
TARGET="$1"
if [[ ! -d $TARGET ]]; then
    echo "directory does not exist: $TARGET"
    exit 1
fi
cd "$TARGET"
find . -maxdepth 1 -type f | while read -r i; do
    progname=$(echo -n "$i" | sed -e 's/_.*//')
    mv "$i" "$progname"
    zip "$i.zip" "$progname"
    rm "$progname"
done
